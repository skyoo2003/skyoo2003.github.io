---
layout: post
title:  Pyenv을 통한 파이썬 가상 환경 관리
date:   2017-03-14T23:02:29+0900
categories: [all, python]
permalink: /post/:year/:month/:day/:title
published: true
---

파이썬이라는 언어를 사용하다보면 다양한 버전 환경에 직면하게 됩니다. OS 자체에 설치된 시스템 파이썬이 존재하고, 혹은 소스 빌드를 통해 파이썬을 사용할 수도 있죠.

2.x 혹은 3.x 의 메이저 버전에 따라 크게는 문법부터 파이썬 내장 라이브러리의 구현까지도 차이도 있을 수 있습니다. 오죽하면 내가 작성한 파이썬은 2.x 버전 기준이야! 라고 명시하기 위해 `#!/usr/bin/env python2` 과 같이 명시하곤 합니다.

하나의 프로젝트에서는 단일 파이썬 버전을 사용하는 경우가 일반적이지만, 종종 하나의 시스템에서 여러 프로젝트의 산출물이 동작하는 경우가 있습니다. 예를 들어, 'A'라는 프로젝트는 Python-2.7 기준으로 작성되어있다고 하고, 'B'라는 프로젝트는 Python-3.4 기준으로 작성되어 있다고 가정해봅시다. A라는 프로젝트에서는 2.7 파이썬을 설치하는 스크립트도 작성해야하며, 프로젝트의 파이썬 스크립트를 구동할 때, 2.7 파이썬을 통해 동작하도록 환경변수도 관리해주어야 합니다. B프로젝트도 동일할 겁니다. 매 프로젝트마다 같은 작업이 반복된다면 번거롭고 귀찮을 것 입니다.

앞에서 언급한 케이스 이외에도 다양한 파이썬 버전을 관리하고자하는 니즈가 있다면, pyenv는 좋은 해결방안이 되어줄 것이라 생각합니다.

## 핵심 기능 간략 소개

Pyenv가 제공하는 기능은 간략하게 다음과 같습니다.

- 사용자 별로 Global Python Version 을 변경할 수 있다.
- 프로젝트 단위로 파이썬 버전을 관리하는 기능을 사용할 수 있다.
- 환경변수를 통해 파이썬 버전을 오버라이딩하는 것도 허용된다.
- 특정 시점에 여러 파이썬 버전을 조회할 수 있다. 이는 다양한 버전에서 테스트를 수행하는 라이브러리나 CI툴 등에서 유용하다.

그리고, 유사한 솔루션과의 차이점은 다음과 같다고 소개하고 있습니다.

- 파이썬에 의존성이 없다. 순수한 쉘 스크립트로 구현되어 있다.
- 쉘에서 Pyenv를 환경변수로 로딩할 필요가 있다. 즉, `$PATH` 에 pyenv's shim 을 접근하기 위한 디렉토리를 추가해주어야 한다.
- virtualenv 를 관리할 수 있다. 직접 virtualenv 를 사용할 수도 있으며, 혹은 pyenv-virtualenv 를 통해 가상환경을 만드는 일련의 프로세스를 자동화할 수 있다.

## 동작 원리 이해하기

고수준으로 pyenv는 `$PATH`에 등록된 pyenv의 shim 실행 파일을 주입하여 어플리케이션 단에서 파이썬 버전을 선택하여 수행할 수 있도록 기능을 지원하고 있습니다. 즉, `$PATH`의 동작원리, `pyenv shim`의 원리를 이해아혀야 어떻게 파이썬 버전을 쉽게 관리할 수 있었는지 알 수 있을 것 입니다.

_$PATH 환경변수 이해하기_

유닉스, 리눅스 시스템에서는 특정 명령을 수행할 때, `$PATH`에 등록된 디렉토리 리스트에서 실행 가능한 파일 (Executable file)을 순서대로 찾도록 되어 있습니다. 일반적으로 사용하는 `cd`, `rm` 등의 명령어도 `$PATH`라는 환경변수에 등록이 되어 있기 때문에 가능한 것 입니다. 만약 `$PATH`에 등록되지 않았다면, 매번 `/bin/cd`, `/bin/rm`과 같이 절대 경로로 실행 가능한 파일을 명시해주어야할 것 입니다.

추가로 특이한 점은, `$PATH`에서 왼쪽->오른쪽 순서로 디렉토리를 탐색하고, 동일한 실행 파일명을 가지고 있다면, 먼저 발견된 디렉토리의 실행 파일을 사용하게 됩니다.

예를 들어, `PATH=/usr/local/bin:/usr/bin:/bin`와 같이 설정되어 있고, `find` 라는 명령어를 쉘에 입력하였다면, `/usr/local/bin`에서 찾은 뒤에 존재하지 않다면, `/usr/bin` 역시 존재하지 않다면 `/bin` 디렉토리에서 찾도록 되어 있습니다.

_Pyenv shims 이해하기_

Pyenv를 설치하면 `PATH=$(pyenv root)/shims:/usr/local/bin:/usr/bin:/bin` 과 같은 형태로 `shims` 디렉토리가 추가됩니다.

## 참고 링크

[1] [github.com/yyuu/pyenv](https://github.com/yyuu/pyenv){:target="_blank"}
