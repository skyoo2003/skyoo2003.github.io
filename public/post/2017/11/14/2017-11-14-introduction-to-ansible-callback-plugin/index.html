<!DOCTYPE html>
<html lang="en-us">
<head>
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <script type="text/javascript" src="https://latest.cactus.chat/cactus.js"></script>
  <link rel="stylesheet" href="https://latest.cactus.chat/style.css" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Ansible Callback Plugin 소개 | Devlog in the SKY</title>
  <link rel = 'canonical' href = 'https://skyoo2003.github.io/post/2017/11/14/2017-11-14-introduction-to-ansible-callback-plugin/'>
  <meta name="description" content="Devlog in the SKY - Yet another developer&#39;s blog">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="Ansible Callback Plugin 소개" />
<meta property="og:description" content="Ansible Plugin 중에서 Callback Plugin 에 관련한 부분만 정리합니다. Callback Plugin 은 Ansible 에서 특정 이벤트 발생 시 데이터를 로깅한다거나 Slack, Mail 등의 외부 채널로 Write 하는 등의 다양한 목적을 달성하기 위해 사용하는 모듈입니다. 참고로 이 내용은 Ansible 2.2.1.0 기준으로 작성되었습니다.
소개 Ansible Callback Plugin 은 Ansible 의 각종 이벤트를 Hooking 해서 해당 시점에 원하는 로직을 수행할 수 있는 플러그인을 말합니다. 이 콜백 플러그인은 Ansible Task, Playbook 등에 대해 &ldquo;실행 직전&rdquo;, &ldquo;실행 종료&rdquo; 등의 이벤트에 대한 콜백 함수를 정의할 수 있도록 지원합니다." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://skyoo2003.github.io/post/2017/11/14/2017-11-14-introduction-to-ansible-callback-plugin/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-11-14T21:44:56+09:00" />
<meta property="article:modified_time" content="2017-11-14T21:44:56+09:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Ansible Callback Plugin 소개"/>
<meta name="twitter:description" content="Ansible Plugin 중에서 Callback Plugin 에 관련한 부분만 정리합니다. Callback Plugin 은 Ansible 에서 특정 이벤트 발생 시 데이터를 로깅한다거나 Slack, Mail 등의 외부 채널로 Write 하는 등의 다양한 목적을 달성하기 위해 사용하는 모듈입니다. 참고로 이 내용은 Ansible 2.2.1.0 기준으로 작성되었습니다.
소개 Ansible Callback Plugin 은 Ansible 의 각종 이벤트를 Hooking 해서 해당 시점에 원하는 로직을 수행할 수 있는 플러그인을 말합니다. 이 콜백 플러그인은 Ansible Task, Playbook 등에 대해 &ldquo;실행 직전&rdquo;, &ldquo;실행 종료&rdquo; 등의 이벤트에 대한 콜백 함수를 정의할 수 있도록 지원합니다."/>

  
  
    
  
  
  <link rel="stylesheet" href="https://skyoo2003.github.io/css/styles.94f653e9e151e28067a7c5dbbc4600cbd5a3c721e79faaf971e523c40f3b249b8e4f20bb57810dfffa8d559ca5c140fd56eb4cd9c0853113ad08e66afdb08bdd.css" integrity="sha512-lPZT6eFR4oBnp8XbvEYAy9WjxyHnn6r5ceUjxA87JJuOTyC7V4EN//qNVZylwUD9VutM2cCFMROtCOZq/bCL3Q=="> 

  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://skyoo2003.github.io/images/favicon.ico" />

  
  
  
  
  
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-85297310-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">Posts</a></li>
         
        <li><a href="/tags">Tags</a></li>
         
        <li><a href="/about">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://skyoo2003.github.io/post/2017/11/14/2017-11-14-ansible-module-develop/" aria-label="Previous">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="https://skyoo2003.github.io/post/2022/05/26/2022-05-26-various-terminology/" aria-label="Next">
            <i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i>
          </a>
        </li>
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#" aria-label="Share">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fskyoo2003.github.io%2fpost%2f2017%2f11%2f14%2f2017-11-14-introduction-to-ansible-callback-plugin%2f" aria-label="Facebook">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fskyoo2003.github.io%2fpost%2f2017%2f11%2f14%2f2017-11-14-introduction-to-ansible-callback-plugin%2f&text=Ansible%20Callback%20Plugin%20%ec%86%8c%ea%b0%9c" aria-label="Twitter">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fskyoo2003.github.io%2fpost%2f2017%2f11%2f14%2f2017-11-14-introduction-to-ansible-callback-plugin%2f&title=Ansible%20Callback%20Plugin%20%ec%86%8c%ea%b0%9c" aria-label="Linkedin">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fskyoo2003.github.io%2fpost%2f2017%2f11%2f14%2f2017-11-14-introduction-to-ansible-callback-plugin%2f&is_video=false&description=Ansible%20Callback%20Plugin%20%ec%86%8c%ea%b0%9c" aria-label="Pinterest">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Ansible%20Callback%20Plugin%20%ec%86%8c%ea%b0%9c&body=Check out this article: https%3a%2f%2fskyoo2003.github.io%2fpost%2f2017%2f11%2f14%2f2017-11-14-introduction-to-ansible-callback-plugin%2f" aria-label="Email">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fskyoo2003.github.io%2fpost%2f2017%2f11%2f14%2f2017-11-14-introduction-to-ansible-callback-plugin%2f&title=Ansible%20Callback%20Plugin%20%ec%86%8c%ea%b0%9c" aria-label="Pocket">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fskyoo2003.github.io%2fpost%2f2017%2f11%2f14%2f2017-11-14-introduction-to-ansible-callback-plugin%2f&title=Ansible%20Callback%20Plugin%20%ec%86%8c%ea%b0%9c" aria-label="reddit">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fskyoo2003.github.io%2fpost%2f2017%2f11%2f14%2f2017-11-14-introduction-to-ansible-callback-plugin%2f&name=Ansible%20Callback%20Plugin%20%ec%86%8c%ea%b0%9c&description=Ansible%20Plugin%20%ec%a4%91%ec%97%90%ec%84%9c%20Callback%20Plugin%20%ec%97%90%20%ea%b4%80%eb%a0%a8%ed%95%9c%20%eb%b6%80%eb%b6%84%eb%a7%8c%20%ec%a0%95%eb%a6%ac%ed%95%a9%eb%8b%88%eb%8b%a4.%20Callback%20Plugin%20%ec%9d%80%20Ansible%20%ec%97%90%ec%84%9c%20%ed%8a%b9%ec%a0%95%20%ec%9d%b4%eb%b2%a4%ed%8a%b8%20%eb%b0%9c%ec%83%9d%20%ec%8b%9c%20%eb%8d%b0%ec%9d%b4%ed%84%b0%eb%a5%bc%20%eb%a1%9c%ea%b9%85%ed%95%9c%eb%8b%a4%ea%b1%b0%eb%82%98%20Slack%2c%20Mail%20%eb%93%b1%ec%9d%98%20%ec%99%b8%eb%b6%80%20%ec%b1%84%eb%84%90%eb%a1%9c%20Write%20%ed%95%98%eb%8a%94%20%eb%93%b1%ec%9d%98%20%eb%8b%a4%ec%96%91%ed%95%9c%20%eb%aa%a9%ec%a0%81%ec%9d%84%20%eb%8b%ac%ec%84%b1%ed%95%98%ea%b8%b0%20%ec%9c%84%ed%95%b4%20%ec%82%ac%ec%9a%a9%ed%95%98%eb%8a%94%20%eb%aa%a8%eb%93%88%ec%9e%85%eb%8b%88%eb%8b%a4.%20%ec%b0%b8%ea%b3%a0%eb%a1%9c%20%ec%9d%b4%20%eb%82%b4%ec%9a%a9%ec%9d%80%20Ansible%202.2.1.0%20%ea%b8%b0%ec%a4%80%ec%9c%bc%eb%a1%9c%20%ec%9e%91%ec%84%b1%eb%90%98%ec%97%88%ec%8a%b5%eb%8b%88%eb%8b%a4.%0a%ec%86%8c%ea%b0%9c%20Ansible%20Callback%20Plugin%20%ec%9d%80%20Ansible%20%ec%9d%98%20%ea%b0%81%ec%a2%85%20%ec%9d%b4%eb%b2%a4%ed%8a%b8%eb%a5%bc%20Hooking%20%ed%95%b4%ec%84%9c%20%ed%95%b4%eb%8b%b9%20%ec%8b%9c%ec%a0%90%ec%97%90%20%ec%9b%90%ed%95%98%eb%8a%94%20%eb%a1%9c%ec%a7%81%ec%9d%84%20%ec%88%98%ed%96%89%ed%95%a0%20%ec%88%98%20%ec%9e%88%eb%8a%94%20%ed%94%8c%eb%9f%ac%ea%b7%b8%ec%9d%b8%ec%9d%84%20%eb%a7%90%ed%95%a9%eb%8b%88%eb%8b%a4.%20%ec%9d%b4%20%ec%bd%9c%eb%b0%b1%20%ed%94%8c%eb%9f%ac%ea%b7%b8%ec%9d%b8%ec%9d%80%20Ansible%20Task%2c%20Playbook%20%eb%93%b1%ec%97%90%20%eb%8c%80%ed%95%b4%20%26ldquo%3b%ec%8b%a4%ed%96%89%20%ec%a7%81%ec%a0%84%26rdquo%3b%2c%20%26ldquo%3b%ec%8b%a4%ed%96%89%20%ec%a2%85%eb%a3%8c%26rdquo%3b%20%eb%93%b1%ec%9d%98%20%ec%9d%b4%eb%b2%a4%ed%8a%b8%ec%97%90%20%eb%8c%80%ed%95%9c%20%ec%bd%9c%eb%b0%b1%20%ed%95%a8%ec%88%98%eb%a5%bc%20%ec%a0%95%ec%9d%98%ed%95%a0%20%ec%88%98%20%ec%9e%88%eb%8f%84%eb%a1%9d%20%ec%a7%80%ec%9b%90%ed%95%a9%eb%8b%88%eb%8b%a4." aria-label="Tumblr">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fskyoo2003.github.io%2fpost%2f2017%2f11%2f14%2f2017-11-14-introduction-to-ansible-callback-plugin%2f&t=Ansible%20Callback%20Plugin%20%ec%86%8c%ea%b0%9c" aria-label="Hacker News">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        Ansible Callback Plugin 소개
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2017-11-14 21:44:56 &#43;0900 KST" itemprop="datePublished">2017-11-14</time>
          
        </div>
        
        
        
        
        <div class="article-tag">
            <i class="fas fa-tag"></i>
            
            
            <a class="tag-link" href="/tags/ansible" rel="tag">ansible</a>
            
        </div>
        
      </div>
    </header>

  
    
    <div id="toc">
      <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#소개">소개</a></li>
        <li><a href="#환경-설정">환경 설정</a></li>
        <li><a href="#이벤트-후킹-event-hooking">이벤트 후킹 (Event Hooking)</a></li>
        <li><a href="#구현-예제">구현 예제</a></li>
        <li><a href="#참고-링크">참고 링크</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
    
    <div class="content" itemprop="articleBody">
      <p>Ansible Plugin 중에서 <strong>Callback Plugin</strong> 에 관련한 부분만 정리합니다. Callback Plugin 은 Ansible 에서 특정 이벤트 발생 시 데이터를 로깅한다거나 Slack, Mail 등의 외부 채널로 Write 하는 등의 다양한 목적을 달성하기 위해 사용하는 모듈입니다. 참고로 이 내용은 <strong>Ansible 2.2.1.0</strong> 기준으로 작성되었습니다.</p>
<h3 id="소개">소개</h3>
<p><strong>Ansible Callback Plugin</strong> 은 Ansible 의 각종 이벤트를 Hooking 해서 해당 시점에 원하는 로직을 수행할 수 있는 플러그인을 말합니다. 이 콜백 플러그인은 Ansible Task, Playbook 등에 대해 &ldquo;실행 직전&rdquo;, &ldquo;실행 종료&rdquo; 등의 이벤트에 대한 콜백 함수를 정의할 수 있도록 지원합니다.</p>
<p>기본적으로 Callback Plugin 들은 <strong>callback_whitelist</strong> 라는 Ansible 환경 변수에 등록된 플러그인에 대해서만 콜백 함수가 동작하도록 되어 있습니다. 단, 콜백 모듈을 CALLBACK_NEEDS_WHITELIST = False 로 설정한 경우에는 무관합니다.</p>
<p>그리고, Callback Plugin 의 실행 순서는 Alphanumeric 순으로 실행됩니다. (e.g. 1.py → 2.py → a.py) 설정에 등록된 콜백 리스트 순서와는 무관합니다.</p>
<h3 id="환경-설정">환경 설정</h3>
<p>Callback Plugin 을 사용하기 위한 각종 Ansible 환경 설정을 정리합니다. 이 환경변수들은 ansible.cfg 파일에 정의해서 사용해도 되며, 커맨드라인을 통해 전달하는 방식도 가능합니다.</p>
<ul>
<li><strong>callback_plugins</strong> : 콜백 플러그인이 있는 디렉토리 위치를 지정합니다.</li>
</ul>
<blockquote>
<p>(ex) callback_plugins = ~/.ansible/plugins/callback:/usr/share/ansible/plugins/callback</p>
</blockquote>
<ul>
<li><strong>stdout_callback</strong> : stdout 에 대한 기본 콜백을 변경합니다. CALLBACK_TYPE = stdout 인 콜백 플러그인 모듈만 지정이 가능합니다.</li>
</ul>
<blockquote>
<p>(ex) stdout_callback = skippy</p>
</blockquote>
<ul>
<li><strong>callback_whitelist</strong> : 콜백을 동작시킬 플러그인 이름을 지정합니다. CALLBACK_NEEDS_WHITELIST = False 인 콜백 플러그인 모듈은 무관합니다.</li>
</ul>
<blockquote>
<p>(ex) callback_whitelist = timer,mail</p>
</blockquote>
<h3 id="이벤트-후킹-event-hooking">이벤트 후킹 (Event Hooking)</h3>
<p>Ansible 프로젝트의 &ldquo;lib/ansible/plugins/callback/__init__.py&rdquo; 의 소스에 존재하는 CallbackBase 클래스의 Public Method가 이벤트 후킹 가능한 콜백 함수를 의미 합니다.</p>
<p>Callback Plugin 을 구현하는 경우, CallbackBase 클래스를 상속해서 사용할 이벤트를 Override 하시면 됩니다. 만약, Ansible 2.0 버전 이상에 해당하는 이벤트에만 콜백 함수가 동작하기를 원하하는 경우에는 함수에 &ldquo;v2_&rdquo; 접두어를 붙인 메소드를 Override 하시면 됩니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#6272a4"># 아래는 오버라이딩 가능한 메소드 리스트 입니다.</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span><span style="color:#6272a4"># Ansible 2.0 이상의 콜백 플러그인을 구현하시는 경우에는 v2_ 접두사를 추가로 붙여주시면 됩니다. (e.g.</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">set_play_context</span>(self, play_context):
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>    <span style="color:#ff79c6">pass</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">on_any</span>(self, <span style="color:#ff79c6">*</span>args, <span style="color:#ff79c6">**</span>kwargs):
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>    <span style="color:#ff79c6">pass</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">runner_on_failed</span>(self, host, res, ignore_errors<span style="color:#ff79c6">=</span><span style="color:#ff79c6">False</span>):
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>    <span style="color:#ff79c6">pass</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">runner_on_ok</span>(self, host, res):
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>    <span style="color:#ff79c6">pass</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">runner_on_skipped</span>(self, host, item<span style="color:#ff79c6">=</span><span style="color:#ff79c6">None</span>):
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>    <span style="color:#ff79c6">pass</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">runner_on_unreachable</span>(self, host, res):
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>    <span style="color:#ff79c6">pass</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">runner_on_no_hosts</span>(self):
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>    <span style="color:#ff79c6">pass</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">runner_on_async_poll</span>(self, host, res, jid, clock):
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>    <span style="color:#ff79c6">pass</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">runner_on_async_ok</span>(self, host, res, jid):
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span>    <span style="color:#ff79c6">pass</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">runner_on_async_failed</span>(self, host, res, jid):
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span><span>    <span style="color:#ff79c6">pass</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">playbook_on_start</span>(self):
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span>    <span style="color:#ff79c6">pass</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">playbook_on_notify</span>(self, host, handler):
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span><span>    <span style="color:#ff79c6">pass</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">playbook_on_no_hosts_matched</span>(self):
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span><span>    <span style="color:#ff79c6">pass</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">playbook_on_no_hosts_remaining</span>(self):
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span><span>    <span style="color:#ff79c6">pass</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">playbook_on_task_start</span>(self, name, is_conditional):
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span><span>    <span style="color:#ff79c6">pass</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">playbook_on_vars_prompt</span>(self, varname, private<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>, prompt<span style="color:#ff79c6">=</span><span style="color:#ff79c6">None</span>, encrypt<span style="color:#ff79c6">=</span><span style="color:#ff79c6">None</span>, confirm<span style="color:#ff79c6">=</span><span style="color:#ff79c6">False</span>, salt_size<span style="color:#ff79c6">=</span><span style="color:#ff79c6">None</span>, salt<span style="color:#ff79c6">=</span><span style="color:#ff79c6">None</span>, default<span style="color:#ff79c6">=</span><span style="color:#ff79c6">None</span>):
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span><span>    <span style="color:#ff79c6">pass</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">playbook_on_setup</span>(self):
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span><span>    <span style="color:#ff79c6">pass</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37</span><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">playbook_on_import_for_host</span>(self, host, imported_file):
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38</span><span>    <span style="color:#ff79c6">pass</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39</span><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">playbook_on_not_import_for_host</span>(self, host, missing_file):
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40</span><span>    <span style="color:#ff79c6">pass</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41</span><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">playbook_on_play_start</span>(self, name):
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42</span><span>    <span style="color:#ff79c6">pass</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43</span><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">playbook_on_stats</span>(self, stats):
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44</span><span>    <span style="color:#ff79c6">pass</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45</span><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">on_file_diff</span>(self, host, diff):
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46</span><span>    <span style="color:#ff79c6">pass</span>
</span></span></code></pre></div><h3 id="구현-예제">구현 예제</h3>
<p>아래의 Ansible Plugin 은 <a href="https://github.com/jlafon/ansible-profile">[jlafon/ansible-profile]</a>{:target=&quot;_blank&quot;} 프로젝트를 차용하였다는 점을 먼저 알려드립니다.</p>
<p>이 플러그인에 대해서 간략하게 설명하자면, playbook의 task의 수행 시간을 메모리에 적재한 뒤에 playbook이 종료되기 전 태스크의 수행 시간을 Display 해주는 간단한 플러그인 입니다. 코드의 내용을 참고해주시면 이해가 될 것으로 생각되고, 플러그인에 대해서 설명이 필요한 부분은 주석을 참고하시면 됩니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#ff79c6">import</span> datetime
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span><span style="color:#ff79c6">import</span> os
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span><span style="color:#ff79c6">import</span> time
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span><span style="color:#ff79c6">from</span> ansible.plugins.callback <span style="color:#ff79c6">import</span> CallbackBase
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">CallbackModule</span>(CallbackBase):
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>    <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span><span style="color:#f1fa8c">    A plugin for timing tasks
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span><span style="color:#f1fa8c">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>    <span style="color:#6272a4"># 아래는 콜백 플러그인에 필수로 정의되어야 하는 클래스 속성 입니다.</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>    CALLBACK_VERSION <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">2.0</span> <span style="color:#6272a4"># 콜백 플러그인 버전을 명시 합니다.</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>    CALLBACK_TYPE <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;notification&#39;</span> <span style="color:#6272a4"># &#39;stdout&#39;, &#39;notification&#39;, &#39;aggregate&#39; 중에 하나를 사용합니다</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>    CALLBACK_NAME <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;profile_tasks&#39;</span> <span style="color:#6272a4"># 콜백 모듈의 이름을 정의 합니다. Whitelist 에 등록할 때 사용됩니다.</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>    CALLBACK_NEEDS_WHITELIST <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">True</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>    
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>    <span style="color:#6272a4"># 콜백 플러그인의 초기화 부분이 들어갑니다.</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>    <span style="color:#ff79c6">def</span> __init__(self):
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>        <span style="color:#8be9fd;font-style:italic">super</span>(CallbackModule, self)<span style="color:#ff79c6">.</span>__init__()
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span>        self<span style="color:#ff79c6">.</span>stats <span style="color:#ff79c6">=</span> {}
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span>        self<span style="color:#ff79c6">.</span>current <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">None</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span>    
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span><span>    <span style="color:#6272a4"># Playbook 내의 각 Task가 실행 될 때, 수행되는 로직을 구현합니다.</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">playbook_on_task_start</span>(self, name, is_conditional):
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span><span><span style="color:#f1fa8c">        Logs the start of each task
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span><span>        <span style="color:#ff79c6">if</span> os<span style="color:#ff79c6">.</span>getenv(<span style="color:#f1fa8c">&#34;ANSIBLE_PROFILE_DISABLE&#34;</span>) <span style="color:#ff79c6">is</span> <span style="color:#ff79c6">not</span> <span style="color:#ff79c6">None</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span><span>            <span style="color:#ff79c6">return</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span><span>        <span style="color:#ff79c6">if</span> self<span style="color:#ff79c6">.</span>current <span style="color:#ff79c6">is</span> <span style="color:#ff79c6">not</span> <span style="color:#ff79c6">None</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span><span>            <span style="color:#6272a4"># Record the running time of the last executed task</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span><span>            self<span style="color:#ff79c6">.</span>stats[self<span style="color:#ff79c6">.</span>current] <span style="color:#ff79c6">=</span> time<span style="color:#ff79c6">.</span>time() <span style="color:#ff79c6">-</span> self<span style="color:#ff79c6">.</span>stats[self<span style="color:#ff79c6">.</span>current]
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span><span>        <span style="color:#6272a4"># Record the start time of the current task</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span><span>        self<span style="color:#ff79c6">.</span>current <span style="color:#ff79c6">=</span> name
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span><span>        self<span style="color:#ff79c6">.</span>stats[self<span style="color:#ff79c6">.</span>current] <span style="color:#ff79c6">=</span> time<span style="color:#ff79c6">.</span>time()
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span><span>    
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span><span>    <span style="color:#6272a4"># Playbook이 완료되었을 때, 수행되는 로직을 구현합니다.</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37</span><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">playbook_on_stats</span>(self, stats):
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38</span><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39</span><span><span style="color:#f1fa8c">        Prints the timings
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40</span><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41</span><span>        <span style="color:#ff79c6">if</span> os<span style="color:#ff79c6">.</span>getenv(<span style="color:#f1fa8c">&#34;ANSIBLE_PROFILE_DISABLE&#34;</span>) <span style="color:#ff79c6">is</span> <span style="color:#ff79c6">not</span> <span style="color:#ff79c6">None</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42</span><span>            <span style="color:#ff79c6">return</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43</span><span>        <span style="color:#6272a4"># Record the timing of the very last task</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44</span><span>        <span style="color:#ff79c6">if</span> self<span style="color:#ff79c6">.</span>current <span style="color:#ff79c6">is</span> <span style="color:#ff79c6">not</span> <span style="color:#ff79c6">None</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45</span><span>            self<span style="color:#ff79c6">.</span>stats[self<span style="color:#ff79c6">.</span>current] <span style="color:#ff79c6">=</span> time<span style="color:#ff79c6">.</span>time() <span style="color:#ff79c6">-</span> self<span style="color:#ff79c6">.</span>stats[self<span style="color:#ff79c6">.</span>current]
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46</span><span>        <span style="color:#6272a4"># Sort the tasks by their running time</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47</span><span>        results <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">sorted</span>(
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48</span><span>            self<span style="color:#ff79c6">.</span>stats<span style="color:#ff79c6">.</span>items(),
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49</span><span>            key<span style="color:#ff79c6">=</span><span style="color:#ff79c6">lambda</span> value: value[<span style="color:#bd93f9">1</span>],
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50</span><span>            reverse<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51</span><span>        )
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52</span><span>        <span style="color:#6272a4"># Just keep the top 10</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53</span><span>        results <span style="color:#ff79c6">=</span> results[:<span style="color:#bd93f9">10</span>]
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54</span><span>        <span style="color:#6272a4"># Print the timings</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55</span><span>        <span style="color:#ff79c6">for</span> name, elapsed <span style="color:#ff79c6">in</span> results:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56</span><span>            <span style="color:#8be9fd;font-style:italic">print</span>(
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57</span><span>                <span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">{0:-&lt;70}{1:-&gt;9}</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">.</span>format(
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58</span><span>                    <span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">{0}</span><span style="color:#f1fa8c"> &#39;</span><span style="color:#ff79c6">.</span>format(name),
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59</span><span>                    <span style="color:#f1fa8c">&#39; </span><span style="color:#f1fa8c">{0:.02f}</span><span style="color:#f1fa8c">s&#39;</span><span style="color:#ff79c6">.</span>format(elapsed),
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60</span><span>                )
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61</span><span>            )
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62</span><span>        total_seconds <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">sum</span>([x[<span style="color:#bd93f9">1</span>] <span style="color:#ff79c6">for</span> x <span style="color:#ff79c6">in</span> self<span style="color:#ff79c6">.</span>stats<span style="color:#ff79c6">.</span>items()])
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63</span><span>        <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">Playbook finished: </span><span style="color:#f1fa8c">{0}</span><span style="color:#f1fa8c">, </span><span style="color:#f1fa8c">{1}</span><span style="color:#f1fa8c"> total tasks.  </span><span style="color:#f1fa8c">{2}</span><span style="color:#f1fa8c"> elapsed. </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">.</span>format(
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64</span><span>                time<span style="color:#ff79c6">.</span>asctime(),
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65</span><span>                <span style="color:#8be9fd;font-style:italic">len</span>(self<span style="color:#ff79c6">.</span>stats<span style="color:#ff79c6">.</span>items()),
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66</span><span>                datetime<span style="color:#ff79c6">.</span>timedelta(seconds<span style="color:#ff79c6">=</span>(<span style="color:#8be9fd;font-style:italic">int</span>(total_seconds)))
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67</span><span>                )
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68</span><span>          )
</span></span></code></pre></div><p>아래는 &lsquo;profile_task&rsquo; Callback Plugin 의 출력 예시 입니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span>ansible &lt;args here&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>&lt;normal output here&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>PLAY RECAP ********************************************************************
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>really slow task | Download project packages-----------------------------11.61s
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>security | Really slow security policies-----------------------------------7.03s
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>common-base | Install core system dependencies-----------------------------3.62s
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>common | Install pip-------------------------------------------------------3.60s
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>common | Install boto------------------------------------------------------3.57s
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>nginx | Install nginx------------------------------------------------------3.41s
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>serf | Install system dependencies-----------------------------------------3.38s
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>duo_security | Install Duo Unix SSH Integration----------------------------3.37s
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>loggly | Install TLS version-----------------------------------------------3.36s
</span></span></code></pre></div><h3 id="참고-링크">참고 링크</h3>
<p>[1] <a href="http://docs.ansible.com/ansible/dev_guide/developing_plugins.html#callback-plugins">Ansible Callback Plugin</a>{:target=&quot;_blank&quot;}</p>
<p>[2] <a href="http://docs.ansible.com/ansible/dev_guide/developing_plugins.html#developing-callback-plugins">Custom Callback Plugin 예제</a>{:target=&quot;_blank&quot;}</p>
<p>[3] <a href="https://github.com/ansible/ansible/blob/devel/lib/ansible/plugins/callback">표준 Callback Plugin 리스트</a>{:target=&quot;_blank&quot;}</p>

    </div>
  </article>

  
  




  <div class="blog-post-comments">
    
      <div id="disqus_thread">
  <script type="text/javascript">
    (function() {
      
      
      
      
    
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'devlog-in-the-sky';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="https://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

    
  </div>



  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/posts">Posts</a></li>
         
          <li><a href="/tags">Tags</a></li>
         
          <li><a href="/about">About</a></li>
        
      </ul>
    </div>

    

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fskyoo2003.github.io%2fpost%2f2017%2f11%2f14%2f2017-11-14-introduction-to-ansible-callback-plugin%2f" aria-label="Facebook">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fskyoo2003.github.io%2fpost%2f2017%2f11%2f14%2f2017-11-14-introduction-to-ansible-callback-plugin%2f&text=Ansible%20Callback%20Plugin%20%ec%86%8c%ea%b0%9c" aria-label="Twitter">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fskyoo2003.github.io%2fpost%2f2017%2f11%2f14%2f2017-11-14-introduction-to-ansible-callback-plugin%2f&title=Ansible%20Callback%20Plugin%20%ec%86%8c%ea%b0%9c" aria-label="Linkedin">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fskyoo2003.github.io%2fpost%2f2017%2f11%2f14%2f2017-11-14-introduction-to-ansible-callback-plugin%2f&is_video=false&description=Ansible%20Callback%20Plugin%20%ec%86%8c%ea%b0%9c" aria-label="Pinterest">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Ansible%20Callback%20Plugin%20%ec%86%8c%ea%b0%9c&body=Check out this article: https%3a%2f%2fskyoo2003.github.io%2fpost%2f2017%2f11%2f14%2f2017-11-14-introduction-to-ansible-callback-plugin%2f" aria-label="Email">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fskyoo2003.github.io%2fpost%2f2017%2f11%2f14%2f2017-11-14-introduction-to-ansible-callback-plugin%2f&title=Ansible%20Callback%20Plugin%20%ec%86%8c%ea%b0%9c" aria-label="Pocket">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fskyoo2003.github.io%2fpost%2f2017%2f11%2f14%2f2017-11-14-introduction-to-ansible-callback-plugin%2f&title=Ansible%20Callback%20Plugin%20%ec%86%8c%ea%b0%9c" aria-label="reddit">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fskyoo2003.github.io%2fpost%2f2017%2f11%2f14%2f2017-11-14-introduction-to-ansible-callback-plugin%2f&name=Ansible%20Callback%20Plugin%20%ec%86%8c%ea%b0%9c&description=Ansible%20Plugin%20%ec%a4%91%ec%97%90%ec%84%9c%20Callback%20Plugin%20%ec%97%90%20%ea%b4%80%eb%a0%a8%ed%95%9c%20%eb%b6%80%eb%b6%84%eb%a7%8c%20%ec%a0%95%eb%a6%ac%ed%95%a9%eb%8b%88%eb%8b%a4.%20Callback%20Plugin%20%ec%9d%80%20Ansible%20%ec%97%90%ec%84%9c%20%ed%8a%b9%ec%a0%95%20%ec%9d%b4%eb%b2%a4%ed%8a%b8%20%eb%b0%9c%ec%83%9d%20%ec%8b%9c%20%eb%8d%b0%ec%9d%b4%ed%84%b0%eb%a5%bc%20%eb%a1%9c%ea%b9%85%ed%95%9c%eb%8b%a4%ea%b1%b0%eb%82%98%20Slack%2c%20Mail%20%eb%93%b1%ec%9d%98%20%ec%99%b8%eb%b6%80%20%ec%b1%84%eb%84%90%eb%a1%9c%20Write%20%ed%95%98%eb%8a%94%20%eb%93%b1%ec%9d%98%20%eb%8b%a4%ec%96%91%ed%95%9c%20%eb%aa%a9%ec%a0%81%ec%9d%84%20%eb%8b%ac%ec%84%b1%ed%95%98%ea%b8%b0%20%ec%9c%84%ed%95%b4%20%ec%82%ac%ec%9a%a9%ed%95%98%eb%8a%94%20%eb%aa%a8%eb%93%88%ec%9e%85%eb%8b%88%eb%8b%a4.%20%ec%b0%b8%ea%b3%a0%eb%a1%9c%20%ec%9d%b4%20%eb%82%b4%ec%9a%a9%ec%9d%80%20Ansible%202.2.1.0%20%ea%b8%b0%ec%a4%80%ec%9c%bc%eb%a1%9c%20%ec%9e%91%ec%84%b1%eb%90%98%ec%97%88%ec%8a%b5%eb%8b%88%eb%8b%a4.%0a%ec%86%8c%ea%b0%9c%20Ansible%20Callback%20Plugin%20%ec%9d%80%20Ansible%20%ec%9d%98%20%ea%b0%81%ec%a2%85%20%ec%9d%b4%eb%b2%a4%ed%8a%b8%eb%a5%bc%20Hooking%20%ed%95%b4%ec%84%9c%20%ed%95%b4%eb%8b%b9%20%ec%8b%9c%ec%a0%90%ec%97%90%20%ec%9b%90%ed%95%98%eb%8a%94%20%eb%a1%9c%ec%a7%81%ec%9d%84%20%ec%88%98%ed%96%89%ed%95%a0%20%ec%88%98%20%ec%9e%88%eb%8a%94%20%ed%94%8c%eb%9f%ac%ea%b7%b8%ec%9d%b8%ec%9d%84%20%eb%a7%90%ed%95%a9%eb%8b%88%eb%8b%a4.%20%ec%9d%b4%20%ec%bd%9c%eb%b0%b1%20%ed%94%8c%eb%9f%ac%ea%b7%b8%ec%9d%b8%ec%9d%80%20Ansible%20Task%2c%20Playbook%20%eb%93%b1%ec%97%90%20%eb%8c%80%ed%95%b4%20%26ldquo%3b%ec%8b%a4%ed%96%89%20%ec%a7%81%ec%a0%84%26rdquo%3b%2c%20%26ldquo%3b%ec%8b%a4%ed%96%89%20%ec%a2%85%eb%a3%8c%26rdquo%3b%20%eb%93%b1%ec%9d%98%20%ec%9d%b4%eb%b2%a4%ed%8a%b8%ec%97%90%20%eb%8c%80%ed%95%9c%20%ec%bd%9c%eb%b0%b1%20%ed%95%a8%ec%88%98%eb%a5%bc%20%ec%a0%95%ec%9d%98%ed%95%a0%20%ec%88%98%20%ec%9e%88%eb%8f%84%eb%a1%9d%20%ec%a7%80%ec%9b%90%ed%95%a9%eb%8b%88%eb%8b%a4." aria-label="Tumblr">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fskyoo2003.github.io%2fpost%2f2017%2f11%2f14%2f2017-11-14-introduction-to-ansible-callback-plugin%2f&t=Ansible%20Callback%20Plugin%20%ec%86%8c%ea%b0%9c" aria-label="Hacker News">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu-toggle" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;" aria-label="Menu">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
        <a id="share-toggle" class="icon" href="#" onclick="$('#share-footer').toggle();return false;" aria-label="Share">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2022  Sung-Kyu Yoo 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">Posts</a></li>
         
        <li><a href="/tags">Tags</a></li>
         
        <li><a href="/about">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>

<script src=/js/code-copy.js></script>



  


<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    },
    svg: {
      fontCache: 'global'
    }
  };
</script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>

</html>
